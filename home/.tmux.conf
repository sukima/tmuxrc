# Tmux Solarized Fix - Found from:
# http://superuser.com/questions/401668/solarized-background-colour-off-in-emacs-under-tmux
# screen-256color allows ^S in vim where xterm-256color Blocks ^S in vim
set -g default-terminal "screen-256color"
set-option -g base-index 1
set-window-option -g pane-base-index 1

# On MacOSX you need this in tmux session to stop odd behavior.
# Add this line to your `.tmux.conf.local`
# set -g default-command "reattach-to-user-namespace -l bash"

unbind-key C-b
set-option -g prefix C-Space
# set-option -g prefix2 C-x
# bind-key C-x send-prefix -2
bind-key Space next-layout
bind-key C-Space last-window
bind-key C-b copy-mode
bind-key v copy-mode

bind-key h select-pane -L
bind-key j select-pane -D
bind-key k select-pane -U
bind-key l select-pane -R

# Smart pane switching with awareness of vim splits
is_vim='echo "#{pane_current_command}" | grep -iqE "(^|\/)(g?(view|n?vim?)(diff)?|git|mutt)$"'
bind -n C-h if-shell "$is_vim" "send-keys C-h" "select-pane -L"
bind -n C-j if-shell "$is_vim" "send-keys C-j" "select-pane -D"
bind -n C-k if-shell "$is_vim" "send-keys C-k" "select-pane -U"
bind -n C-l if-shell "$is_vim" "send-keys C-l" "select-pane -R"
bind -n C-\ if-shell "$is_vim" "send-keys C-\\" "select-pane -l"

bind-key J command-prompt -p "Join pane from (hoz):"  "join-pane -s '%%'"
bind-key C-j command-prompt -p "Join pane from (vert):"  "join-pane -v -s '%%'"
bind-key S command-prompt -p "Send pane to (hoz):"  "join-pane -t '%%'"
bind-key C-s command-prompt -p "Send pane to (vert):"  "join-pane -v -t '%%'"
#unbind-key % # Remove default binding since weâ€™re replacing
bind-key r source-file ~/.tmux.conf
bind-key C-c command-prompt -p "New session:" "new-session -s '%%'"
bind-key m lock-server

# Copy mode
#set-window-option -g xterm-keys on
setw -g mode-keys vi
setw -g status-keys vi
# unbind-key [
unbind-key p
bind-key p paste-buffer
bind-key Enter paste-buffer
bind-key -t vi-copy v begin-selection
bind-key -t vi-copy y copy-selection
bind-key -t vi-copy V rectangle-toggle
bind-key -t vi-copy Escape cancel
bind-key C-e run "~/.bin/tmuxemoji"

# Fix for missing default-path option. (Removed in tmux v1.9)
bind-key "'" split-window -c "#{pane_current_path}"
bind-key '"' split-window -h -c "#{pane_current_path}"
bind-key % split-window -h -c "#{pane_current_path}"
bind-key c new-window -c "#{pane_current_path}"

# Resize'n
bind-key ^ command-prompt -p "Set pane width (hoz):"  "resize-pane -x '%%'"
bind-key _ command-prompt -p "Set pane height (vert):"  "resize-pane -y '%%'"

if-shell '[[ $(echo "$(tmux -V | cut -d" " -f2) >= 2.1" | bc) -eq 1 ]]' 'source-file $HOME/.tmux/mouse.conf'

setw -g aggressive-resize on
set-option -g display-time 4000
set -g status-bg black
set -g status-fg green
set -g status-left-length 40
set -g status-left '#[bg=colour240,fg=white] I am enough '
set -ag status-left '#[default] #{session_name}'
set -g status-right '#{=10:host_short} '
set -ag status-right '#(~/.bin/tmux_battery_charge_indicator)'
set -ag status-right '#[bg=white,fg=colour240] %H:%M '
set -ag status-right '#[bg=colour240,fg=white] %Y-%m-%d '
set -g status-justify centre

set -sg escape-time 0

# Quick Notes
# See http://faq.sealedabstract.com/uninterruptible_programming_supply/
bind-key C-n split-window -v -l 15 "vim $HOME/NOTES.otl"

# Plugins. (Must be in ~/.tmux.conf)
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-yank'

source-file $HOME/.tmux.conf.local

if-shell "[ -f $HOME/.tmux/plugins/tpm/tpm ]" "run-shell $HOME/.tmux/plugins/tpm/tpm"
